"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7505],{32259:(t,e,a)=>{a.r(e),a.d(e,{contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var n=a(87462),i=(a(67294),a(3905));a(8209);const r={title:"1 - Enabling Kafka"},o="Enabling Kafka",s={unversionedId:"guides/kafka/intro",id:"guides/kafka/intro",isDocsHomePage:!1,title:"1 - Enabling Kafka",description:"The Kafka settings are only enabled if your Organization is on a dedicated cluster. Contact us if you are interested in this feature.  You can also use Ditto's Live Query Webhook, which is free for all users.",source:"@site/docs/common/guides/kafka/1-intro.md",sourceDirName:"guides/kafka",slug:"/guides/kafka/intro",permalink:"/common/guides/kafka/intro",editUrl:"https://github.com/getditto/docs/edit/main/docs/common/guides/kafka/1-intro.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"1 - Enabling Kafka"},sidebar:"defaultSidebar",previous:{title:"Webhooks",permalink:"/common/guides/livequery-webhook"},next:{title:"2 - Ditto events",permalink:"/common/guides/kafka/consumer"}},l=[{value:"Installing Kafka",id:"installing-kafka",children:[],level:2},{value:"Handling credentials",id:"handling-credentials",children:[],level:2},{value:"Simple test",id:"simple-test",children:[],level:2}],d={toc:l},p="wrapper";function u(t){let{components:e,...r}=t;return(0,i.kt)(p,(0,n.Z)({},d,r,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"enabling-kafka"},"Enabling Kafka"),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The Kafka settings are only enabled if your Organization is on a dedicated cluster. ",(0,i.kt)("a",{parentName:"p",href:"mailto:support@ditto.live"},"Contact us")," if you are interested in this feature.  You can also use Ditto's ",(0,i.kt)("a",{parentName:"p",href:"../livequery-webhook"},"Live Query Webhook"),", which is free for all users."))),(0,i.kt)("p",null,"Kafka is one way to implement CDC (",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Change_data_capture"},"Change Data Capture"),"). The document change stream is a coarse user-consumable Kafka queue that allows you to react to changes made as documents are inserted, updated, or deleted from Ditto's Big Peer. This keeps an external database in sync with Ditto, which can be useful for integration with legacy systems such as business intelligence tools."),(0,i.kt)("h2",{id:"installing-kafka"},"Installing Kafka"),(0,i.kt)("p",null,"If you aren't familiar with Kafka, first follow the instructions on ",(0,i.kt)("a",{parentName:"p",href:"https://kafka.apache.org/quickstart"},"Kafka Quickstart")," to try out basic Kafka locally. In this tutorial, we used scripts in the ",(0,i.kt)("inlineCode",{parentName:"p"},"bin")," directory of ",(0,i.kt)("inlineCode",{parentName:"p"},"kafka_2.13-3.1.0"),"."),(0,i.kt)("h2",{id:"handling-credentials"},"Handling credentials"),(0,i.kt)("p",null,'To connect to your Kafka instance, you need to have an SSL connection. In your organization page, click "Live Query Settings" and you will see the credentials for your cluster. Download the Cluster Certificate and User Certificate. Keep these files safe! '),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Organization Apps > Your App Name > Live Query Settings > Kafka Connection Data")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"kafka credentials",src:a(13060).Z})),(0,i.kt)("p",null,"Here is how these authentication tokens match to the Kafka configuration:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null}),(0,i.kt)("th",{parentName:"tr",align:null},"Ditto Name"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"ssl.truststore.location")),(0,i.kt)("td",{parentName:"tr",align:null},"Cluster Certificate"),(0,i.kt)("td",{parentName:"tr",align:null},"The CA cert in PKCS12 format.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"ssl.truststore.password")),(0,i.kt)("td",{parentName:"tr",align:null},"Cluster certificate password"),(0,i.kt)("td",{parentName:"tr",align:null},"The password used to decrypt the CA Cert value.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"ssl.keystore.location")),(0,i.kt)("td",{parentName:"tr",align:null},"User Certificate"),(0,i.kt)("td",{parentName:"tr",align:null},"User cert in PKCS12 format.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"ssl.keystore.password")),(0,i.kt)("td",{parentName:"tr",align:null},"User certificate password"),(0,i.kt)("td",{parentName:"tr",align:null},"The password used to decrypt the user cert.")))),(0,i.kt)("h2",{id:"simple-test"},"Simple test"),(0,i.kt)("p",null,"You can use the following bash script to test out your cluster. Replace each variable with the corresponding information displayed in your app's live query settings."),(0,i.kt)("p",null,"If it's working, you won't see any errors and the script will not shut down. Leave this script running in a terminal, and open a new terminal for the next section."),(0,i.kt)("p",null,"Currently, Ditto only supports consuming all events from a Ditto application at the Kafka endpoint topic ",(0,i.kt)("inlineCode",{parentName:"p"},"user-consumable-APPID"),". "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"CLUSTER_CERT_LOCATION=/path/to/cluster.p12\nCLUSTER_CERT_PW=<YOUR_CLUSTER_CERT_PASSWORD>\n\nUSER_CERT_LOCATION=/path/to/user.p12\nUSER_CERT_PW=<YOUR_USER_CERT_PASSWORD>\n\nCLOUD_ENDPOINT=<YOUR_ENDPOINT>\nTOPIC=<YOUR_TOPIC>\n\nKAFKA=/path/to/kafka_2.13-3.1.0\n\n$KAFKA/bin/kafka-console-consumer.sh \\\n --bootstrap-server $CLOUD_ENDPOINT \\\n --consumer-property security.protocol=SSL \\\n --consumer-property ssl.truststore.password=$CLUSTER_CERT_PW \\\n --consumer-property ssl.truststore.location=$CLUSTER_CERT_LOCATION \\\n --consumer-property ssl.keystore.password=$USER_CERT_PW \\\n --consumer-property ssl.keystore.location=$USER_CERT_LOCATION \\\n --group $TOPIC \\\n --topic $TOPIC \n")),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The Kafka ",(0,i.kt)("inlineCode",{parentName:"p"},"Group")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Topic")," should both be set to the same string displayed in the Ditto portal."))))}u.isMDXComponent=!0},13060:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/kafka-browser-fc06d4e4570b17e09d3b114112159160.png"}}]);