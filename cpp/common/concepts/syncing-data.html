<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D8PMW3CCL2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-D8PMW3CCL2",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Ditto" href="/opensearch.xml">
<!-- Google Tag Manager -->
    <script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-PV7QFWF",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
    <!-- End Google Tag Manager -->
<script src="/js/fix-trailing-slash.js"></script><title data-react-helmet="true">Syncing | Ditto</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.ditto.live/cpp/common/concepts/syncing-data"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-cpp-current"><meta data-react-helmet="true" property="og:title" content="Syncing | Ditto"><meta data-react-helmet="true" name="description" content="How Does Ditto Sync Data?"><meta data-react-helmet="true" property="og:description" content="How Does Ditto Sync Data?"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.ditto.live/cpp/common/concepts/syncing-data"><link data-react-helmet="true" rel="alternate" href="https://docs.ditto.live/cpp/common/concepts/syncing-data" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.ditto.live/cpp/common/concepts/syncing-data" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://F25GUUSPFJ-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.9fa6fe62.css">
<link rel="preload" href="/assets/js/runtime~main.3d95b589.js" as="script">
<link rel="preload" href="/assets/js/main.7ea66c8e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" width="25" height="25"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path></svg></button><a href="https://ditto.live" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logos/blue.png" alt="Ditto Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logos/blue.png" alt="Ditto Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Ditto</b></a><a class="navbar__item navbar__link" href="/">Documentation</a><a href="https://github.com/getditto/samples" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Example Apps</span></a><a href="https://github.com/getditto" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Open Source</span></a><a href="https://github.com/getditto/docs/discussions/categories/roadmap-and-ideas" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Roadmap</span></a><a class="navbar__item navbar__link" href="/changelog">Changelog</a><a class="navbar__item navbar__link" href="/faq">FAQ</a></div><div class="navbar__items navbar__items--right"><a href="https://portal.ditto.live" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Login</span></a><div class="searchBox_Bc3W"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_LIo8"><nav class="overflow-y-auto menu thin-scrollbar overflow-x-visible menu_oAhv menuWithAnnouncementBar_IVfW"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/cpp/installation">Installation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Getting Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/documents">Documents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/writing">Writing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/querying">Querying</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cpp/common/concepts/syncing-data">Syncing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/remove">Removing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/schemas">Schemas</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Types</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Mesh Network</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Change Data Capture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">How it Works</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a href="https://software.ditto.live/cpp/Ditto/4.0.1/api-reference/" target="_blank" rel="noopener noreferrer" class="menu__link"><span>API Reference</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/cpp/common/v3">3.0 Migration guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/cpp/common/v4">4.0 Migration guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/cpp/common/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/cpp/common/faq">Frequently Asked Questions</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_MGa7"><div class="docItemContainer_PQH2"><article class="prose max-w-none"><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_psec"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Syncing</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="how-does-ditto-sync-data">How Does Ditto Sync Data?<a aria-hidden="true" class="hash-link" href="#how-does-ditto-sync-data" title="Direct link to heading">​</a></h2><p>In this narrated video, take a glimpse under the hood of Ditto&#x27;s unique sync process. This video will
explain how Ditto utilizes multiple transports at once to efficiently sync data with or even without the
internet, as well as the strengths and limitations of each transport that come together to form what we call the <strong>Rainbow Connection</strong>. </p><div class="iframe-container" align="center"><iframe class="responsive-iframe" width="560" height="315" src="https://www.youtube.com/embed/8_A1CkYfzoM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe></div><p>By default, Ditto will not sync data with other devices.  When the device is
observing a query, it requests to synchronize data that matches the query from
other devices in the mesh network. </p><p>In other words, when a live query is created, Ditto&#x27;s sync system
<strong>pulls</strong> data from other devices. There is no way to &quot;push&quot; data through the
API explicitly. Devices select data they are interested in through the query
system and then synchronize with the mesh network based on that query.</p><p><img alt="Query-based Subscriptions" src="/assets/images/syncing_data_1_subscribe-958b49e82de5018d49fae57ac93925f1.jpg"></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="multi-hop-replication">Multi-hop replication<a aria-hidden="true" class="hash-link" href="#multi-hop-replication" title="Direct link to heading">​</a></h2><p>Given that Ditto works peer-to-peer, devices can form into arbitrary groups
based on the proximity to one another, or rather they create an ad-hoc mesh
network. Ditto&#x27;s sync system allows for devices to share data through another
device, called &quot;multi-hop&quot; sync. The only requirement for this to occur is that
all devices in the chain must be observing the same data, as shown below:</p><p><img alt="Multi-hop Subscriptions" src="/assets/images/syncing_data_2_same_sub-f9d8a0f380a8822f286ecc8355c81ea7.jpg"></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="sync">Sync<a aria-hidden="true" class="hash-link" href="#sync" title="Direct link to heading">​</a></h2><p>The small peer uses a selfish, query-based synchronization protocol. That means
each device needs to explicitly tell other peers what data to sync using a query. Each peer also must explicitly opt-in to
start synchronizing data. </p><p>Preferably, you should tell ditto to start synchronizing early on in your application&#x27;s life cycle like in your <code>AppDelegate.application(_:didFinishLaunchingWithOptions:)</code> or <code>Application.onCreate</code> method. Your application only needs to call this function once.</p><div class="tabs-container"><div class="sm:hidden"><label for="tabs" class="sr-only">Select a tab</label><select id="tabs" name="tabs" class="block w-full focus:ring-blue-500 focus:border-blue-500 border-gray-300 rounded-md"><option selected="" value="swift">Swift</option><option value="objc">Objective-C</option></select></div><div class="hidden sm:block"><nav class="flex space-x-4" aria-label="Tabs"><button class="bg-blue-100 text-blue-700 px-3 py-2 font-medium text-sm rounded-md" aria-current="page">Swift</button><button class="text-gray-500 hover:text-gray-700 px-3 py-2 font-medium text-sm rounded-md">Objective-C</button></nav></div><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">try! ditto.startSync()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 objc"><pre tabindex="0" class="prism-code language-objc codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">NSError </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">error </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> nil</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">ditto startSync</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="subscribe">Subscribe<a aria-hidden="true" class="hash-link" href="#subscribe" title="Direct link to heading">​</a></h3><p>Creating a subscription acts as a signal to other peers that you are interested in
receiving updates when local or remote changes are made to
documents that match the given query. </p><p>The returned Subscription object must be kept in scope for as long as
you want to keep receiving updates. This function is useful if you&#x27;re
interested in subscribing to changes on a query to have a local offline copy of
the data.</p><div class="tabs-container"><div class="sm:hidden"><label for="tabs" class="sr-only">Select a tab</label><select id="tabs" name="tabs" class="block w-full focus:ring-blue-500 focus:border-blue-500 border-gray-300 rounded-md"><option selected="" value="swift">Swift</option><option value="objc">Objective-C</option></select></div><div class="hidden sm:block"><nav class="flex space-x-4" aria-label="Tabs"><button class="bg-blue-100 text-blue-700 px-3 py-2 font-medium text-sm rounded-md" aria-current="page">Swift</button><button class="text-gray-500 hover:text-gray-700 px-3 py-2 font-medium text-sm rounded-md">Objective-C</button></nav></div><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">// Register live query to update UI</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">let subscription = ditto.store.collection(&quot;cars&quot;).find(&quot;color == &#x27;red&#x27;&quot;).subscribe()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 objc"><pre tabindex="0" class="prism-code language-objc codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Register live query to update UI</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">DITCollection </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">collection </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">ditto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">store collection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;cars&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">DITSubscription </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">subscription </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">collection find</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;color == &#x27;red&#x27;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> subscribe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div></div></div></div><ul><li>Call <code>.subscribe</code> after <code>ditto.startSync()</code> to synchronize and download real-time data from other peers.</li><li>To stop the <code>subscription</code>, call <code>subscription.cancel()</code>.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="observe">Observe<a aria-hidden="true" class="hash-link" href="#observe" title="Direct link to heading">​</a></h3><p>Create a query to get notified when the database gets new changes. The returned
LiveQuery object must be kept in scope for as long as you want to keep receiving
updates. <a href="/cpp/common/concepts/querying">Learn more about how to create queries</a></p><div class="tabs-container"><div class="sm:hidden"><label for="tabs" class="sr-only">Select a tab</label><select id="tabs" name="tabs" class="block w-full focus:ring-blue-500 focus:border-blue-500 border-gray-300 rounded-md"><option selected="" value="swift">Swift</option><option value="objc">Objective-C</option></select></div><div class="hidden sm:block"><nav class="flex space-x-4" aria-label="Tabs"><button class="bg-blue-100 text-blue-700 px-3 py-2 font-medium text-sm rounded-md" aria-current="page">Swift</button><button class="text-gray-500 hover:text-gray-700 px-3 py-2 font-medium text-sm rounded-md">Objective-C</button></nav></div><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">// --- Action somewhere in your application</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">func userDidInsertCar() {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    _ = try? ditto.store.collection(&quot;cars&quot;).upsert([</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        &quot;model&quot;: &quot;Ford&quot;,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        &quot;color&quot;: &quot;black&quot;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ] as [String: Any?])</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// Register live query to update UI</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">let liveQuery = ditto.store.collection(&quot;cars&quot;).find(&quot;color == &#x27;red&#x27;&quot;)</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    .observeLocal { cars, event in</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        // do something</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 objc"><pre tabindex="0" class="prism-code language-objc codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Register live query to update UI</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">DITCollection </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">collection </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">ditto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">store collection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;cars&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">DITLiveQuery </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">liveQuery </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">collection find</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;color == &#x27;red&#x27;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    observeLocal</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token operator" style="color:rgb(212, 212, 212)">^</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">NSArray</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">DITDocument </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">docs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DITLiveQueryEvent </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">event</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div></div></div></div><ul><li>Call <code>.observeLocal</code> to observe real-time data from your local database.</li><li>The callback will immediately run for documents that fit the query.</li><li>The callback will get called with all local changes that fit the query. </li><li>The callback will get called for each sync or write transaction.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="livequeryevent">LiveQueryEvent<a aria-hidden="true" class="hash-link" href="#livequeryevent" title="Direct link to heading">​</a></h3><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Reactive frameworks like React, Jetpack Compose, and SwiftUI are designed to
make UI development more efficient and help programmers build responsive
applications with minimal effort. They achieve this by abstracting the process
of updating the UI and providing optimized solutions for managing state and
rendering components. This eliminates the need for programmers to manually
implement a diffing algorithm. </p></div></div><p>If you are not using a reactive framework such as React, Jetpack Compose, or SwiftUI, you might
benefit from reacting to changes from Ditto&#x27;s <code>LiveQueryEvent</code> object. A LiveQuery
callback has two arguments: <code>docs</code> and <code>event</code>. The <code>event</code> argument allows you
to identify which documents have changed in the database. There are two types of
events:</p><ul><li><code>Initial</code>: The first event that will be delivered and it will only be delivered once.</li><li><code>Update</code>: This event will be delivered each time the results of the provided query change. It contains information about the set of documents that previously matched the query before the update, along with information about what documents have been inserted, deleted, updated, or moved, as part of the set of matching documents.</li></ul><p>For more information, see <code>LiveQueryEvent</code> in the Ditto API reference for your language.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="sync-only-relevant-documents">Sync only relevant documents<a aria-hidden="true" class="hash-link" href="#sync-only-relevant-documents" title="Direct link to heading">​</a></h3><p>To reduce memory and disk usage over time, <em>ONLY</em> sync documents that are relevant for a given device at a
given time. There are various approaches to this problem, and it depends on your application.</p><p>For example, if you are building a meal ordering application, you may want to
only synchronize all orders that have been created in the past 24 hours. </p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">ditto.store.collection(&quot;orders&quot;).find(&quot;createdAt &gt; $args.yesterday&quot;, args: [</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;yesterday&quot;: Date().adding(hr:-24),</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">]).observeLocal({ cars, event in</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">     // do something</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">})</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><p>If there are 2,000 orders per day, you would see 2,000 documents
locally on the device. If each document is 50Kb, the device could
replicate up to ~100 megabytes to the local database. </p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="how-can-i-subscribe-to-multiple-queries">How can I subscribe to multiple queries?<a aria-hidden="true" class="hash-link" href="#how-can-i-subscribe-to-multiple-queries" title="Direct link to heading">​</a></h2><p>Option A. Store them as multiple properties on a managed object that is kept in
scope. If the subscription falls out of scope, it will become garbage collected and sync will stop.</p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">var subscribeA: DittoSubscription? = nil</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">var subscribeB: DittoSubscription? = nil</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">var liveQueryA: DittoLiveQuery? = nil</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">var liveQueryB: DittoLiveQuery? = nil</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><p>Option B: You could also store these objects as arrays. </p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">var subscriptions = [DittoSubscription]()</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">var liveQueries = [DittoLiveQuery]()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="how-can-i-stop-to-subscribing-data">How can I stop to subscribing data?<a aria-hidden="true" class="hash-link" href="#how-can-i-stop-to-subscribing-data" title="Direct link to heading">​</a></h2><p>Ensure that you always <code>cancel</code> or <code>stop</code> on subscriptions when you no longer
wish to subscribe to a query.</p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">// subscription = nil // this does not work</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sub.cancel() // this is correct!</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">// subscriptions.removeAll() Do not do this &lt;- this will not work</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">for sub in subscriptions {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   sub.cancel()</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">subscriptions.removeAll() // After calling cancel, it is safe to remove them from the array.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="eviction">Eviction<a aria-hidden="true" class="hash-link" href="#eviction" title="Direct link to heading">​</a></h2><p>When you subscribe to data that is relevant, you need to remove it from the
local device once it is no longer relevant. You want to remove data from the
local database <em>without</em> deleting that data on other devices. This operation is different than remove in that it only removes one or more
documents from the local storage and <strong>does not sync the change to other
devices.</strong></p><p>You need to stop subscriptions before calling <code>evict()</code> because even if you
reset the data in a device, the data will come back immediately if the
subscription is alive. We recommend that you evict data once per day or once per
week.</p><div class="tabs-container"><div class="sm:hidden"><label for="tabs" class="sr-only">Select a tab</label><select id="tabs" name="tabs" class="block w-full focus:ring-blue-500 focus:border-blue-500 border-gray-300 rounded-md"><option selected="" value="swift">Swift</option><option value="objc">Objective-C</option></select></div><div class="hidden sm:block"><nav class="flex space-x-4" aria-label="Tabs"><button class="bg-blue-100 text-blue-700 px-3 py-2 font-medium text-sm rounded-md" aria-current="page">Swift</button><button class="text-gray-500 hover:text-gray-700 px-3 py-2 font-medium text-sm rounded-md">Objective-C</button></nav></div><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">collection.find(&quot;owner == &#x27;Bob&#x27;&quot;).evict()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 objc"><pre tabindex="0" class="prism-code language-objc codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">NSArray</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">DITDocumentID </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">evictedIDs </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">collection find</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;make == &#x27;Honda&#x27;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> evict</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="how-can-i-remove-data">How can I remove data?<a aria-hidden="true" class="hash-link" href="#how-can-i-remove-data" title="Direct link to heading">​</a></h3><p>Consider using a &quot;soft-delete&quot; pattern in your application. You should use a
field like <code>isDeleted: true</code> instead of calling <code>remove()</code>, and then evict that data. You can query and
synchronize only the documents that not been marked archived. Using a
soft-delete pattern, documents can be synced or updated again if necessary. </p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">struct Note {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let _id: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    var text: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    var isDeleted: Bool</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// deleting data</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">note.deleted = true</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// evicting old data once a week</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">collection.find(&quot;isDeleted == true&quot;).evict()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="examples">Examples<a aria-hidden="true" class="hash-link" href="#examples" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1-time-based-syncing">1: Time-based syncing<a aria-hidden="true" class="hash-link" href="#1-time-based-syncing" title="Direct link to heading">​</a></h3><p>One common design pattern is to only synchronize data that was written within the
past 24 hours. At the end of that 24 hours, documents older than 24 hours are evicted and a
new query is created.</p><p>Let&#x27;s look through a typical example for syncing data: four flight attendants walk
through an airlane and record passenger meal orders on their tablets. </p><p>The database has a <code>flights</code> collection, with each flight represented as a
document. Each document has a <code>createdAt</code> timestamp.</p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 json"><pre tabindex="0" class="prism-code language-json codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token property">&quot;createdAt&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;2022-09-17T20:00:46.945Z&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token property">&quot;flightNo&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;DIT101&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token property">&quot;orders&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token property">&quot;abcdef123&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      ...</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><p>We want to only store data on the device that was created in the past 24 hours.
Anything older than 24 hours should be removed locally from the device. However,
we don&#x27;t want to remove this data from the entire mesh network, because we may
want to do analytics on it later using the Big Peer. So, we do not use remove()
because that deletes data from the entire network, including the Cloud. We use
<code>evict()</code> to remove data from the local device because the data is not relevant
anymore.</p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">ditto.store.collection(&quot;flights&quot;).find(&quot;createdAt &lt;= $args.yesterday&quot;, args: [</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;yesterday&quot;: yesterday(),</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">]).evict()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><p>One way to implement eviction would be to create a global interval. For example,
every 24 hours check to see if there is any data on the local machine that is
irrelevant. If so, evict it.</p><p>Whenever you have an eviction query that changes over time it is important that
you also properly stop your subscription and update it with a new query each time your
eviction query changes. This is because if you try to evict data that you are also subscribed to, then
after you evict the data you will immediately sync it back to the device since the
subscription is still syncing that data.</p><p>Using the example of evicting data every 24 hours we will see how to stop the subscription, evict the data,
and then start the new subscription.</p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 24 hours pass. Need to evict irrelevant data.</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 1. Stop subscription</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">subscription.cancel()</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 2. Evict irrelevant data</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ditto.store.collection(&quot;flights&quot;).find(&quot;createdAt &lt;= $args.yesterday&quot;, args: [</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;yesterday&quot;: yesterday(),</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">]).evict()</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 3. Start new subscription</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">subscription = ditto.store.collection(&quot;flights&quot;).find(&quot;createdAt &gt; $args.yesterday&quot;, args: [</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                 &quot;yesterday&quot;: yesterday(),</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">               ]).subscribe()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><p>Notice that the query for eviction is exactly the opposite as the query for subscription. These
queries should not overlap, so you must stop your subscription before you evict.
Your subscription variable should remain in scope throughout the runtime time of the app, so that
it will continue to sync data and not be garbage collected.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2-stateful-syncing">2. Stateful syncing<a aria-hidden="true" class="hash-link" href="#2-stateful-syncing" title="Direct link to heading">​</a></h3><p>Another common design pattern is to build state into each document type. In an
ordering application, orders go through a lifecycle.</p><p>OPEN -&gt; IN PROGRESS -&gt; COMPLETE -&gt; FILLED<br>
<!-- -->|
-&gt; CANCELLED</p><p>When the application starts, the device only wants to synchronize orders that are not
filled or cancelled, and evict any orders that have been completed.</p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">self.query =  self.ditto.collection(&quot;orders&quot;)</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  .find(&quot;status != &#x27;FILLED&#x27; &amp;&amp; status != &#x27;CANCELLED&#x27;&quot;)</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  .subscribe()</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">self.ditto.collection(&quot;orders&quot;).find(&quot;status == &#x27;FILLED&#x27; || status == &#x27;CANCELLED&#x27;&quot;).evict()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><p>Once an order has been completed, document as “FILLED”. Live queries will fire and update the front-page.</p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">self.ditto.collection(&quot;orders&quot;).upsert([</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;_id&quot;: id,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;status&quot;: &quot;FILLED&quot;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">])</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><p>An order could also become cancelled while it was unfilled. A cancelled order is
based on the business logic -- for example, an order could be cancelled
manually, or cancelled when the store closes, or because the order was placed
more than 24 hours prior. </p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">self.ditto.collection(&quot;orders&quot;).upsert([</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;_id&quot;: id,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;status&quot;: &quot;CANCELLED&quot;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">])</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">self.ditto.collection(&quot;orders&quot;).findByID(id).evict()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/getditto/docs/edit/main/docs/common/concepts/syncing-data.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/common/concepts/querying"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->Querying</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/common/concepts/remove"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Removing<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-does-ditto-sync-data" class="table-of-contents__link toc-highlight">How Does Ditto Sync Data?</a></li><li><a href="#multi-hop-replication" class="table-of-contents__link toc-highlight">Multi-hop replication</a></li><li><a href="#sync" class="table-of-contents__link toc-highlight">Sync</a><ul><li><a href="#subscribe" class="table-of-contents__link toc-highlight">Subscribe</a></li><li><a href="#observe" class="table-of-contents__link toc-highlight">Observe</a></li><li><a href="#livequeryevent" class="table-of-contents__link toc-highlight">LiveQueryEvent</a></li><li><a href="#sync-only-relevant-documents" class="table-of-contents__link toc-highlight">Sync only relevant documents</a></li></ul></li><li><a href="#how-can-i-subscribe-to-multiple-queries" class="table-of-contents__link toc-highlight">How can I subscribe to multiple queries?</a></li><li><a href="#how-can-i-stop-to-subscribing-data" class="table-of-contents__link toc-highlight">How can I stop to subscribing data?</a></li><li><a href="#eviction" class="table-of-contents__link toc-highlight">Eviction</a><ul><li><a href="#how-can-i-remove-data" class="table-of-contents__link toc-highlight">How can I remove data?</a></li></ul></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a><ul><li><a href="#1-time-based-syncing" class="table-of-contents__link toc-highlight">1: Time-based syncing</a></li><li><a href="#2-stateful-syncing" class="table-of-contents__link toc-highlight">2. Stateful syncing</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Documentation</a></li><li class="footer__item"><a href="https://www.ditto.live/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Main Website</span></a></li><li class="footer__item"><a href="https://github.com/getditto/samples" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Example Apps</span></a></li><li class="footer__item"><a class="footer__link-item" href="/changelog">Changelog</a></li><li class="footer__item"><a href="https://portal.ditto.live" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Login</span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/getditto/docs/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub Discussions</span></a></li><li class="footer__item"><a href="https://github.com/getditto/docs/discussions/categories/roadmap-and-ideas" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Roadmap</span></a></li><li class="footer__item"><a href="https://github.com/getditto/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Open Source</span></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/ditto" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow</span></a></li><li class="footer__item"><a href="https://twitter.com/dittolive" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter</span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 DittoLive, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3d95b589.js"></script>
<script src="/assets/js/main.7ea66c8e.js"></script>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PV7QFWF" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) --></body>
</html>