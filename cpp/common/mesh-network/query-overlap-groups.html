<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D8PMW3CCL2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-D8PMW3CCL2",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Ditto" href="/opensearch.xml">
<!-- Google Tag Manager -->
    <script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-PV7QFWF",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
    <!-- End Google Tag Manager -->
<script src="/js/fix-trailing-slash.js"></script><title data-react-helmet="true">Query Overlap Groups | Ditto</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.ditto.live/cpp/common/mesh-network/query-overlap-groups"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-cpp-current"><meta data-react-helmet="true" property="og:title" content="Query Overlap Groups | Ditto"><meta data-react-helmet="true" name="description" content="Query Overlap Groups are an optional feature that can be used to group peers"><meta data-react-helmet="true" property="og:description" content="Query Overlap Groups are an optional feature that can be used to group peers"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.ditto.live/cpp/common/mesh-network/query-overlap-groups"><link data-react-helmet="true" rel="alternate" href="https://docs.ditto.live/cpp/common/mesh-network/query-overlap-groups" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.ditto.live/cpp/common/mesh-network/query-overlap-groups" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://F25GUUSPFJ-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.5e310d74.css">
<link rel="preload" href="/assets/js/runtime~main.82241c49.js" as="script">
<link rel="preload" href="/assets/js/main.e761220b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" width="25" height="25"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path></svg></button><a href="https://ditto.live" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logos/blue.png" alt="Ditto Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logos/blue.png" alt="Ditto Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Ditto</b></a><a class="navbar__item navbar__link" href="/">Documentation</a><a href="https://github.com/getditto/samples" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Example Apps</span></a><a href="https://github.com/getditto" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Open Source</span></a><a href="https://github.com/getditto/docs/discussions/categories/roadmap-and-ideas" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Roadmap</span></a><a class="navbar__item navbar__link" href="/changelog">Changelog</a><a class="navbar__item navbar__link" href="/faq">FAQ</a></div><div class="navbar__items navbar__items--right"><a href="https://portal.ditto.live" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Login</span></a><div class="searchBox_Bc3W"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_LIo8"><nav class="overflow-y-auto menu thin-scrollbar overflow-x-visible menu_oAhv menuWithAnnouncementBar_IVfW"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/cpp/installation">Installation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item"><a class="menu__link menu__link--sublist" href="#">Getting Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/documents">Documents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/writing">Writing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/querying">Querying</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/syncing-data">Syncing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/remove">Removing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/schemas">Schemas</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Types</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Mesh Network</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/mesh-network/supported-transports">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/mesh-network/online-playground">Online Playground</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cpp/common/mesh-network/query-overlap-groups">Query Overlap Groups</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/mesh-network/manual">Transport Configuration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Change Data Capture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">How it Works</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a href="https://software.ditto.live/cpp/Ditto/4.1.0/api-reference/" target="_blank" rel="noopener noreferrer" class="menu__link"><span>API Reference</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/cpp/common/v3">3.0 Migration guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/cpp/common/v4">4.0 Migration guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/cpp/common/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/cpp/common/faq">Frequently Asked Questions</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_MGa7"><div class="docItemContainer_PQH2"><article class="prose max-w-none"><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_psec"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Query Overlap Groups</h1></header><p>Query Overlap Groups are an optional feature that can be used to group peers
based on their anticipated queries, and set relative connection priorities
amongst these groups.</p><p>By default, Ditto queries will replicate only documents that match a query between
peers. In some cases, two peers with the same query might be separated by others
who do not share the same query. Consider a simple example of three peers
connected in a line (A - B - C). If A and C share the same query but B does not,
data will not replicate from A to C as B is not interested in the data - and
therefore doesn’t possess it to replicate onwards.</p><p><img alt="Query-based Subscriptions" src="/assets/images/syncing_data_2_ditto_link-8778554ffab36d379002b4704ab5c6a3.png"></p><p>If your use-case includes non-overlapping queries like this example, query
overlap groups are designed to help. You can use Query Overlap Groups to tell
Ditto that peers A and C are likely to have queries that overlap. </p><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>Ditto will create an end-to-end encrypted tunnel for A - C via B. However, Query Overlap Groups are not a security mechanism. A peer may change its Query Overlap Group at runtime for any reason.</p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="use-cases">Use Cases<a aria-hidden="true" class="hash-link" href="#use-cases" title="Direct link to heading">​</a></h3><ul><li>High priority synchronization between same group members</li><li>Ensuring that peers with the same query can fully replicate with each other, even if they are separated by other peers that don’t have the same queries.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="code-example">Code Example<a aria-hidden="true" class="hash-link" href="#code-example" title="Direct link to heading">​</a></h2><p>In this example, we have built a meal ordering app where passengers can see their own
orders, and crew members see all orders. We want the crew devices to use the
passenger devices as multihop points that synchronize all orders in the
background, even though the passenger devices aren&#x27;t observing all orders.</p><p>For all peers in a high-priority Query Overlap Group, Ditto will prioritize
these connections, and set up end-to-end encrypted multihop connections if
direct connections aren’t available. In doing so, the crew can be sure that
their data will remain in sync, even if they’re separated by other passenger devices
in the local mesh.</p><div class="tabs-container"><div class="sm:hidden"><label for="tabs" class="sr-only">Select a tab</label><select id="tabs" name="tabs" class="block w-full focus:ring-blue-500 focus:border-blue-500 border-gray-300 rounded-md"><option selected="" value="swift">Swift</option><option value="objc">Objective-C</option></select></div><div class="hidden sm:block"><nav class="flex space-x-4" aria-label="Tabs"><button class="bg-blue-100 text-blue-700 px-3 py-2 font-medium text-sm rounded-md" aria-current="page">Swift</button><button class="text-gray-500 hover:text-gray-700 px-3 py-2 font-medium text-sm rounded-md">Objective-C</button></nav></div><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">// The passenger only observes orders that they created</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">let passengerQuery = passenger.store.collection(&quot;orders&quot;).find(&quot;user_id==abc123&quot;)</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">let passengerSubscription = passengerQuery.subscribe()</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">let passengerLiveQuery = passengerQuery.observeLocal { docs, event in</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // render passenger orders in a list UI</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// Crew member devices observe all orders that everyone created</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">let crewAQuery = crewA.store.collection(&quot;orders&quot;).findAll()</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">let crewASubscription = crewAQuery.subscribe()</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">let crewALiveQuery = crewAQuery.observeLocal { docs, event in</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // render all orders in a list UI</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">let crewBQuery = crewB.store.collection(&quot;orders&quot;).findAll()</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">let crewBSubscription = crewBQuery.subscribe()</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">let crewBLiveQuery = crewBQuery.observeLocal { docs, event in</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  // render all orders in a list UI</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// Set up our query overlap group and priorities such that the crew members</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// will construct multihop connections with each other.</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">DittoExperimental.setQueryOverlapGroup(queryOverlapGroup: 2, ditto: crewA)</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">DittoExperimental.setQueryOverlapGroup(queryOverlapGroup: 2, ditto: crewB)</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// Query overlap groups should be set before startSync</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">try! passenger.startSync()</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">try! crewA.startSync()</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">try! crewB.startSync()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 objc"><pre tabindex="0" class="prism-code language-objc codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">NSString </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> orders </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;orders&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// The passenger only observes orders that they created</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">passenger</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">store collection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">orders</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> find</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;user_id==abc123&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> observeLocal</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token operator" style="color:rgb(212, 212, 212)">^</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">NSArray</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">DITDocument </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">docs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DITLiveQueryEvent </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">event</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// render my orders in a list UI</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Crew member devices observe all orders that everyone created</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">crewA</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">store collection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">orders</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> find</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;status == &#x27;OPEN&#x27;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> observeLocal</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token operator" style="color:rgb(212, 212, 212)">^</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">NSArray</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">DITDocument </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">docs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DITLiveQueryEvent </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">event</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// render all orders in a list UI</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">crewB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">store collection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">orders</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> find</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;status == &#x27;OPEN&#x27;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> observeLocal</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token operator" style="color:rgb(212, 212, 212)">^</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">NSArray</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">DITDocument </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">docs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DITLiveQueryEvent </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">event</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// render all orders</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Set up our query overlap group and priorities such that the crew members</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// will construct multihop connections with each other.</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">DITExperimental setQueryOverlapGroup</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> ditto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">crewA</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">DITExperimental setQueryOverlapGroup</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> ditto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">crewB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Query overlap groups should be set before startSync</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">crewA startSync</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">nil</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">crewB startSync</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">nil</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">passenger startSync</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">nil</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="what-do-the-numbers-mean">What do the numbers mean?<a aria-hidden="true" class="hash-link" href="#what-do-the-numbers-mean" title="Direct link to heading">​</a></h3><p>The numeric value for a query overlap group is entirely use-case specific and
apps are free to use whichever values they like - provided all peers agree on
the meaning of the values. All peers belong to query overlap group 0 initially
and will connect with normal priority until specified otherwise. The number that
represents the query group doesn’t mean that the group has higher priority. The
number is just an enum to represent the group. To assign priority, see
<a href="#setting-priority">Setting Priority</a> below.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="setting-priority">Setting priority<a aria-hidden="true" class="hash-link" href="#setting-priority" title="Direct link to heading">​</a></h2><p>You can configure the priority with which Ditto should connect to any peers in the given
Query Overlap Group. If the priority is set to high, an end-to-end encrypted
multihop connection will be established wherever it is not possible to establish
a direct connection. Connections can be established in either direction, so
the remote peers might attempt connections to this Ditto with different
priorities unless they are similarly configured.</p><p>In our above example, passenger apps can configure a high-priority connection
preference for crew members. In doing so, passenger devices establish a direct
connection to crew member devices if possible, and otherwise establish an end-to-end encrypted
connection hopping via other passengers if needed. The end-to-end encrypted
connection guarantees passenger-to-crew replication without personal information
being readable by other passengers along the way.</p><p>Extending our previous example, here we configure the crew devices with the
query overlap group “2” to treat other peers in group “2” as a high-priority
connection target. </p><div class="tabs-container"><div class="sm:hidden"><label for="tabs" class="sr-only">Select a tab</label><select id="tabs" name="tabs" class="block w-full focus:ring-blue-500 focus:border-blue-500 border-gray-300 rounded-md"><option selected="" value="swift">Swift</option><option value="objc">Objective-C</option></select></div><div class="hidden sm:block"><nav class="flex space-x-4" aria-label="Tabs"><button class="bg-blue-100 text-blue-700 px-3 py-2 font-medium text-sm rounded-md" aria-current="page">Swift</button><button class="text-gray-500 hover:text-gray-700 px-3 py-2 font-medium text-sm rounded-md">Objective-C</button></nav></div><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">DittoExperimental.setPriority(DittoConnectionPriority.high, forQueryOverlapGroup: 2, ditto: crewA)</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">DittoExperimental.setPriority(DittoConnectionPriority.high, forQueryOverlapGroup: 2, ditto: crewB)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 objc"><pre tabindex="0" class="prism-code language-objc codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">DITExperimental setPriority</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">DITConnectionPriorityHigh</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                 forQueryOverlapGroup</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> ditto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">crewA</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">DITExperimental setPriority</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">DITConnectionPriorityHigh</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        forQueryOverlapGroup</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> ditto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">crewB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div></div></div></div><p>You could also use this pattern to prevent peers from connecting if you know the
connection would be wasteful. Perhaps you know that different types of peers or
apps don’t share any data in common. In this case, peers can be assigned to the
relevant Query Overlap Group, and the priority can be set to the lowest value of
“don’t connect”. The peers will then save their available connection capacity
for other, potentially more useful connections.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/getditto/docs/edit/main/docs/common/mesh-network/query-overlap-groups.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/common/mesh-network/online-playground"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->Online Playground</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/common/mesh-network/manual"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Transport Configuration<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#use-cases" class="table-of-contents__link toc-highlight">Use Cases</a></li><li><a href="#code-example" class="table-of-contents__link toc-highlight">Code Example</a><ul><li><a href="#what-do-the-numbers-mean" class="table-of-contents__link toc-highlight">What do the numbers mean?</a></li></ul></li><li><a href="#setting-priority" class="table-of-contents__link toc-highlight">Setting priority</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Documentation</a></li><li class="footer__item"><a href="https://www.ditto.live/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Main Website</span></a></li><li class="footer__item"><a href="https://github.com/getditto/samples" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Example Apps</span></a></li><li class="footer__item"><a class="footer__link-item" href="/changelog">Changelog</a></li><li class="footer__item"><a href="https://portal.ditto.live" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Login</span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/getditto/docs/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub Discussions</span></a></li><li class="footer__item"><a href="https://github.com/getditto/docs/discussions/categories/roadmap-and-ideas" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Roadmap</span></a></li><li class="footer__item"><a href="https://github.com/getditto/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Open Source</span></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/ditto" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow</span></a></li><li class="footer__item"><a href="https://twitter.com/dittolive" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter</span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 DittoLive, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.82241c49.js"></script>
<script src="/assets/js/main.e761220b.js"></script>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PV7QFWF" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) --></body>
</html>