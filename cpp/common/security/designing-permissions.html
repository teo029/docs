<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D8PMW3CCL2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-D8PMW3CCL2",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Ditto" href="/opensearch.xml">
<!-- Google Tag Manager -->
    <script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-PV7QFWF",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
    <!-- End Google Tag Manager -->
<script src="/js/fix-trailing-slash.js"></script><title data-react-helmet="true">Access Control Permissions | Ditto</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.ditto.live/cpp/common/security/designing-permissions"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-cpp-current"><meta data-react-helmet="true" property="og:title" content="Access Control Permissions | Ditto"><meta data-react-helmet="true" name="description" content="You can describe permissions attributed using a JSON"><meta data-react-helmet="true" property="og:description" content="You can describe permissions attributed using a JSON"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.ditto.live/cpp/common/security/designing-permissions"><link data-react-helmet="true" rel="alternate" href="https://docs.ditto.live/cpp/common/security/designing-permissions" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.ditto.live/cpp/common/security/designing-permissions" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://F25GUUSPFJ-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.9fa6fe62.css">
<link rel="preload" href="/assets/js/runtime~main.7df8c8ab.js" as="script">
<link rel="preload" href="/assets/js/main.8ec9b15e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" width="25" height="25"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path></svg></button><a href="https://ditto.live" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logos/blue.png" alt="Ditto Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logos/blue.png" alt="Ditto Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Ditto</b></a><a class="navbar__item navbar__link" href="/">Documentation</a><a href="https://github.com/getditto/samples" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Example Apps</span></a><a href="https://github.com/getditto" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Open Source</span></a><a href="https://github.com/getditto/docs/discussions/categories/roadmap-and-ideas" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Roadmap</span></a><a class="navbar__item navbar__link" href="/changelog">Changelog</a><a class="navbar__item navbar__link" href="/faq">FAQ</a></div><div class="navbar__items navbar__items--right"><a href="https://portal.ditto.live" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Login</span></a><div class="searchBox_Bc3W"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_LIo8"><nav class="overflow-y-auto menu thin-scrollbar overflow-x-visible menu_oAhv menuWithAnnouncementBar_IVfW"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/cpp/installation">Installation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item"><a class="menu__link menu__link--sublist" href="#">Getting Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/documents">Documents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/writing">Writing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/querying">Querying</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/syncing-data">Syncing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/remove">Removing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/concepts/schemas">Schemas</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Types</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Mesh Network</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Security</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/security/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/security/authentication">Authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cpp/common/security/designing-permissions">Access Control Permissions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/cpp/common/security/shared-key">Shared Key</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Change Data Capture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">How it Works</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a href="https://software.ditto.live/cpp/Ditto/4.0.1/api-reference/" target="_blank" rel="noopener noreferrer" class="menu__link"><span>API Reference</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/cpp/common/v3">3.0 Migration guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/cpp/common/v4">4.0 Migration guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/cpp/common/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/cpp/common/faq">Frequently Asked Questions</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_MGa7"><div class="docItemContainer_PQH2"><article class="prose max-w-none"><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_psec"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Access Control Permissions</h1></header><p>You can describe permissions attributed using a JSON
document. This JSON document is encoded within the certificate used by each
device. Each peer verifies the cerificates of other peers, and accepts or rejects reads
and writes based on these permissions.</p><p>You can issue each certificiate <a href="/cpp/common/how-it-works/certificate-security">manually</a> or with the <a href="/cpp/common/security/authentication">Online with
Authentication identity</a>. </p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="rejecting-a-user">Rejecting a user<a aria-hidden="true" class="hash-link" href="#rejecting-a-user" title="Direct link to heading">​</a></h2><p>To reject a user from reading or writing at all, specify the JSON payload below.</p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 jsonc"><pre tabindex="0" class="prism-code language-jsonc codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;authenticate&quot;: false</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="accepting-a-user">Accepting a user<a aria-hidden="true" class="hash-link" href="#accepting-a-user" title="Direct link to heading">​</a></h2><p>To grant full <code>read</code> &amp; <code>write</code> permissions to <em>all collections</em> and <em>all documents</em>:</p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 jsonc"><pre tabindex="0" class="prism-code language-jsonc codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;authenticate&quot;: true,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;expirationSeconds&quot;: 28800,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;userID&quot;: &quot;123abc&quot;,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;permissions&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &quot;read&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;everything&quot;: true,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;queriesByCollection&quot;: {}</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    },</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &quot;write&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;everything&quot;: true,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;queriesByCollection&quot;: {}</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><ul><li><code>authenticate</code> to <code>true</code> to tell the webhook that the user has successfully validated</li><li><code>expirationSeconds</code> is <code>number</code> property on how long the authentication session is valid for before a refresh is required.</li><li><code>userID</code> is a <code>string</code> which identifies the the <code>userID</code>. This should be <em>unique</em> across users within your app. </li><li><code>permissions</code> which describes all the types of access control for collections and documents that this user can <code>read</code> or <code>write</code></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="using-the-_id-field">Using the _id field<a aria-hidden="true" class="hash-link" href="#using-the-_id-field" title="Direct link to heading">​</a></h2><p>Currently, you can <strong>only specify a permission query on the <code>_id</code> field of a
document</strong>. Permissions on mutable properties are currently not supported. </p><p>To grant selective permissions on specific documents, add to the
<code>queriesByCollection</code> property inside either the <code>read</code> or <code>write</code> property.
Each key inside <code>queriesByCollection</code> is a reference to the collection. Each
value is an array of <a href="/cpp/common/concepts/querying">ditto queries</a> describing which
documents the user can read or write.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="example">Example<a aria-hidden="true" class="hash-link" href="#example" title="Direct link to heading">​</a></h2><p>The following write permissions below describe that <code>userID: &quot;123abc&quot;</code> can</p><ol><li><code>write</code> to documents in the <code>&quot;books&quot;</code> collection where the <code>_id.locationId == &#x27;abcedef123456&#x27;</code>.</li><li><code>write</code> to any document in the <code>&quot;newspapers&quot;</code> collection. We use a single value of <code>true</code> </li><li><code>read</code> to documents in the <code>&quot;books&quot;</code> collection where the <code>_id.locationId == &#x27;abcedef123456&#x27;</code></li></ol><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 jsonc"><pre tabindex="0" class="prism-code language-jsonc codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;authenticate&quot;: true,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;expirationSeconds&quot;: 28800,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;userID&quot;: &quot;123abc&quot;,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;permissions&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &quot;write&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;everything&quot;: false, // ensure that this is false</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;queriesByCollection&quot;: {</span></span><span class="token-linebg-gray-800 docusaurus-highlight-code-line bg-gray-700" style="color:#9CDCFE"><span class="token plain">        // 1. </span></span><span class="token-linebg-gray-800 docusaurus-highlight-code-line bg-gray-700" style="color:#9CDCFE"><span class="token plain">        &quot;books&quot;: [</span></span><span class="token-linebg-gray-800 docusaurus-highlight-code-line bg-gray-700" style="color:#9CDCFE"><span class="token plain">          _id.locationId == &#x27;abcedef123456&#x27;</span></span><span class="token-linebg-gray-800 docusaurus-highlight-code-line bg-gray-700" style="color:#9CDCFE"><span class="token plain">        ],</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span></span><span class="token-linebg-gray-800 docusaurus-highlight-code-line bg-gray-700" style="color:#9CDCFE"><span class="token plain">        // 2. </span></span><span class="token-linebg-gray-800 docusaurus-highlight-code-line bg-gray-700" style="color:#9CDCFE"><span class="token plain">        &quot;newspapers&quot;: [</span></span><span class="token-linebg-gray-800 docusaurus-highlight-code-line bg-gray-700" style="color:#9CDCFE"><span class="token plain">          &quot;true&quot;</span></span><span class="token-linebg-gray-800 docusaurus-highlight-code-line bg-gray-700" style="color:#9CDCFE"><span class="token plain">        ]</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    },</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &quot;read&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;everything&quot;: false, // ensure that this is false</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;queriesByCollection&quot;: {</span></span><span class="token-linebg-gray-800 docusaurus-highlight-code-line bg-gray-700" style="color:#9CDCFE"><span class="token plain">        // 3.</span></span><span class="token-linebg-gray-800 docusaurus-highlight-code-line bg-gray-700" style="color:#9CDCFE"><span class="token plain">        &quot;books&quot;: [</span></span><span class="token-linebg-gray-800 docusaurus-highlight-code-line bg-gray-700" style="color:#9CDCFE"><span class="token plain">          _id.locationId == &#x27;abcedef123456&#x27;</span></span><span class="token-linebg-gray-800 docusaurus-highlight-code-line bg-gray-700" style="color:#9CDCFE"><span class="token plain">        ],</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="threat-modeling-in-p2p-networks">Threat modeling in P2P networks<a aria-hidden="true" class="hash-link" href="#threat-modeling-in-p2p-networks" title="Direct link to heading">​</a></h2><p>Threat modeling is a process used by software engineers to identify, analyze,
and prioritize threats that could potentially impact an application. It helps
engineers identify potential weak points in an application and take steps to
mitigate those risks. Threat modeling involves identifying the assets that an
application needs to protect, assessing the potential threats to those assets,
and determining the best ways to protect them.</p><p>By identifying potential risks, engineers can ensure that the application is
secure from malicious actors and that users&#x27; data is protected. Threat modeling
can also help ensure that the application meets the company&#x27;s security
standards and regulations. </p><p>Threat modeling in peer-to-peer (P2P) networks is different than that in
client-server networks due to the distributed nature of the P2P network. In a
client-server network, there is a single server that all clients connect to, and
thus all of the data and resources are centralized. This makes it easier to
identify potential threats and vulnerabilities, but creates a entry that can be
targeted by an attacker, making it easier to exploit the entire network at once.</p><p>Peer-to-peer (P2P) networks are networks that do not have a central server, but
rather all nodes are equal, allowing clients to share resources with each other
directly. As such, P2P networks have more restrictive permissions on
synchronization than client-server authentication systems, as nodes are required
to agree to any changes made by other peers. This is done to ensure that no node
has an advantage over another and that all nodes remain secure.  </p><p>Therefore, even though peers in Ditto may have overlapping subscriptions, Ditto peers are only able
to synchronize data directly from a peer that has the authority to write that
document. In other words, small peers are only able to trust writes from other peers that have
the authority to make those writes. They cannot trust each other as a source of
data that they aren&#x27;t authorized to write to, since they can&#x27;t tell the
difference between an edit they made on their own and one which came from a
further hop.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="read-only-security-model">Read-only security model<a aria-hidden="true" class="hash-link" href="#read-only-security-model" title="Direct link to heading">​</a></h3><p>Because Ditto peers are only able to synchronize data directly from a peer that has the authority to write that document, a read-only security model comes with some caveats. This section covers how to best implement this security model and the trade-offs that exist in peer-to-peer networks.</p><p>Ditto provides a mechanism to specify which small peers can read documents in a collection <em>without permission to write</em>. This can be useful in situations where you have restrictive user roles, such as customer and employee. </p><p>To implement read-only documents, you should create restrictive write permissions that include the <code>userId</code> inside of the document <code>_id</code>.  Ditto ensures that only those authorized to create documents with a particular document <code>_id</code> are able to synchronize those documents in a trustworthy manner throughout the system. </p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6"><pre tabindex="0" class="prism-code language-undefined codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;authenticate&quot;: true,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;expirationSeconds&quot;: 28800,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;userID&quot;: &quot;A&quot;,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;permissions&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &quot;read&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;everything&quot;: true,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;queriesByCollection&quot;: {}</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    },</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &quot;write&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;everything&quot;: false,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;queriesByCollection&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        &quot;messages&quot;: [&quot;_id.userID == &#x27;A&#x27;&quot;]</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="read-only-example">Read-only example<a aria-hidden="true" class="hash-link" href="#read-only-example" title="Direct link to heading">​</a></h4><p>In this example, peers can read chat messages from other people, but cannot
write to them. They can only write their own chat messages.</p><p>Imagine three peers, Peer A, B, and C. Peers A and B are connected, but Peer C only connected to peer
B. </p><div class="mermaid" data-mermaid-src="graph LR;
    A[A] --&gt; C[fa:fa-mobile B];
    C--&gt; D[fa:fa-mobile C];">graph LR;
    A[A] --&gt; C[fa:fa-mobile B];
    C--&gt; D[fa:fa-mobile C];</div><p>Every peer has similar permissions, where they can read everything but can only write to a collection with an <code>_id</code> that represents their <code>userID</code>. So, for example, Peer A has the following permissions:</p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 jsonc"><pre tabindex="0" class="prism-code language-jsonc codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;authenticate&quot;: true,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;expirationSeconds&quot;: 28800,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;userID&quot;: &quot;A&quot;,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;permissions&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &quot;read&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;everything&quot;: true,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;queriesByCollection&quot;: {}</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    },</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &quot;write&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;everything&quot;: false,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;queriesByCollection&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        &quot;messages&quot;: [&quot;_id.userID == &#x27;A&#x27;&quot;]</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><p>Peer A writes a message and syncs that message to B.</p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 json"><pre tabindex="0" class="prism-code language-json codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token property">&quot;_id&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token property">&quot;messageId&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;00372532806762369024&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token property">&quot;userID&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;A&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token property">&quot;text&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Hello world!&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><div class="mermaid" data-mermaid-src="graph LR;
    A[A] --&gt; |sync| C[fa:fa-mobile B];">graph LR;
    A[A] --&gt; |sync| C[fa:fa-mobile B];</div><p>However, Peer B cannot forward that message from A to C. This is because peer B does not have write permissions to create documents with <code>userID=A</code>. </p><div class="mermaid" data-mermaid-src="graph LR;
    A[A] --&gt;|sync| B((fa:fa-cloud Big Peer));
    B(&quot;B&quot;)-.Does not sync. B does not have write permissions for userID=A.-&gt; C[fa:fa-mobile C];">graph LR;
    A[A] --&gt;|sync| B((fa:fa-cloud Big Peer));
    B(&quot;B&quot;)-.Does not sync. B does not have write permissions for userID=A.-&gt; C[fa:fa-mobile C];</div><p>Today Ditto enforces that data which has to propagate peer-to-peer must have mutual
write permissions. If integrity is at risk, you have to sign the payloads
yourself at the application level.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><h3 class="anchor anchorWithStickyNavbar_y2LR" id="threat">Threat<a aria-hidden="true" class="hash-link" href="#threat" title="Direct link to heading">​</a></h3><p>A hacker attempts to write messages <em>pretending to be peer A</em> even though they are only allowed to read. </p><ol><li>Steal mobile phone that is authorized as Peer B</li><li>Create documents pretending to be Peer A.  </li></ol><p>This is a credible attack vector, especially if Peer A represents an authority
in the system, such as an administrative user. This design prevents a hacker
from impersonating Peer A, because other peers will only synchronize documents
from Peer A when they have a direct connection to Peer A, and can verify their certificate is valid.  </p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="app-level-security">App-level Security<a aria-hidden="true" class="hash-link" href="#app-level-security" title="Direct link to heading">​</a></h3><p>The access rules contained in the identity are rigid, signed by the central
certificate authority, and enforced by all participating devices. This offers
the highest level of security. If a device is not allowed to access particular
data, it will never be synced to their device. See <a href="/cpp/common/mesh-network/query-overlap-groups">Query Overlap
Groups</a>, for more details on multi-hopping
through untrusted devices.</p><p>For apps with weaker security requirements, a developer may choose to relax the
access rules inside the Ditto certificate, and instead restrict access in their application code.</p><p>One advantage is that the developer has more flexibility to change the access
rules dynamically since they are not encoded in signed certificates. Another
advantage is that all devices in the mesh can participate in syncing the data,
which may help it propagate faster. If certain data is only accessible to a few
privileged devices which are not often in range of each other, it will take
longer for them to sync.</p><p>The disadvantage is that an unprivileged user does have a device containing
privileged data. A technically savvy user or phone thief may be able to gain
access to not only their regular data, but also the more privileged data that
they were never intended to be able to view.</p><p>Therefore relaxed access rules - app-level security - are only suitable for
environments where there is a degree of trust that the devices won&#x27;t end up
unlocked in the wrong hands.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/getditto/docs/edit/main/docs/common/security/designing-permissions.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/common/security/authentication"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->Authentication</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/common/security/shared-key"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Shared Key<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#rejecting-a-user" class="table-of-contents__link toc-highlight">Rejecting a user</a></li><li><a href="#accepting-a-user" class="table-of-contents__link toc-highlight">Accepting a user</a></li><li><a href="#using-the-_id-field" class="table-of-contents__link toc-highlight">Using the _id field</a></li><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li><li><a href="#threat-modeling-in-p2p-networks" class="table-of-contents__link toc-highlight">Threat modeling in P2P networks</a><ul><li><a href="#read-only-security-model" class="table-of-contents__link toc-highlight">Read-only security model</a></li><li><a href="#app-level-security" class="table-of-contents__link toc-highlight">App-level Security</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Documentation</a></li><li class="footer__item"><a href="https://www.ditto.live/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Main Website</span></a></li><li class="footer__item"><a href="https://github.com/getditto/samples" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Example Apps</span></a></li><li class="footer__item"><a class="footer__link-item" href="/changelog">Changelog</a></li><li class="footer__item"><a href="https://portal.ditto.live" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Login</span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/getditto/docs/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub Discussions</span></a></li><li class="footer__item"><a href="https://github.com/getditto/docs/discussions/categories/roadmap-and-ideas" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Roadmap</span></a></li><li class="footer__item"><a href="https://github.com/getditto/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Open Source</span></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/ditto" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow</span></a></li><li class="footer__item"><a href="https://twitter.com/dittolive" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter</span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 DittoLive, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.7df8c8ab.js"></script>
<script src="/assets/js/main.8ec9b15e.js"></script>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PV7QFWF" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) --></body>
</html>