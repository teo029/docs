<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D8PMW3CCL2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-D8PMW3CCL2",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Ditto" href="/opensearch.xml">
<!-- Google Tag Manager -->
    <script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-PV7QFWF",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
    <!-- End Google Tag Manager -->
<script src="/js/fix-trailing-slash.js"></script><title data-react-helmet="true">Schemas | Ditto</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.ditto.live/raspberrypi/common/concepts/schemas"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-raspberrypi-current"><meta data-react-helmet="true" property="og:title" content="Schemas | Ditto"><meta data-react-helmet="true" name="description" content="This section provides guidance about how to model your data inside Ditto&#x27;s collection and document schemaless database."><meta data-react-helmet="true" property="og:description" content="This section provides guidance about how to model your data inside Ditto&#x27;s collection and document schemaless database."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.ditto.live/raspberrypi/common/concepts/schemas"><link data-react-helmet="true" rel="alternate" href="https://docs.ditto.live/raspberrypi/common/concepts/schemas" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.ditto.live/raspberrypi/common/concepts/schemas" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://F25GUUSPFJ-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.9fa6fe62.css">
<link rel="preload" href="/assets/js/runtime~main.117e8c63.js" as="script">
<link rel="preload" href="/assets/js/main.862d2ea9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" width="25" height="25"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path></svg></button><a href="https://ditto.live" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logos/blue.png" alt="Ditto Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logos/blue.png" alt="Ditto Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Ditto</b></a><a class="navbar__item navbar__link" href="/">Documentation</a><a href="https://github.com/getditto/samples" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Example Apps</span></a><a href="https://github.com/getditto" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Open Source</span></a><a href="https://github.com/getditto/docs/discussions/categories/roadmap-and-ideas" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Roadmap</span></a><a class="navbar__item navbar__link" href="/changelog">Changelog</a><a class="navbar__item navbar__link" href="/faq">FAQ</a></div><div class="navbar__items navbar__items--right"><a href="https://portal.ditto.live" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Login</span></a><div class="searchBox_Bc3W"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_LIo8"><nav class="overflow-y-auto menu thin-scrollbar overflow-x-visible menu_oAhv menuWithAnnouncementBar_IVfW"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/raspberrypi/installation">Installation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Getting Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/raspberrypi/common/concepts/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/raspberrypi/common/concepts/documents">Documents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/raspberrypi/common/concepts/writing">Writing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/raspberrypi/common/concepts/querying">Querying</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/raspberrypi/common/concepts/syncing-data">Syncing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link" tabindex="0" href="/raspberrypi/common/concepts/remove">Removing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-NaN menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/raspberrypi/common/concepts/schemas">Schemas</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Types</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Mesh Network</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Change Data Capture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-undefined menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">How it Works</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a href="https://software.ditto.live/cpp/Ditto/4.0.1/api-reference/" target="_blank" rel="noopener noreferrer" class="menu__link"><span>API Reference</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/raspberrypi/common/v3">3.0 Migration guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/raspberrypi/common/v4">4.0 Migration guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/raspberrypi/common/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-undefined menu__list-item"><a class="menu__link" href="/raspberrypi/common/faq">Frequently Asked Questions</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_MGa7"><div class="docItemContainer_PQH2"><article class="prose max-w-none"><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_psec"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Schemas</h1></header><p>This section provides guidance about how to model your data inside Ditto&#x27;s collection and document schemaless database.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="separating-models-for-sync-and-views">Separating models for sync and views<a aria-hidden="true" class="hash-link" href="#separating-models-for-sync-and-views" title="Direct link to heading">​</a></h2><p>If you use a same model for sync and views, it may contain data you don&#x27;t need
to sync over transports, and the sync speed might get slower. We recommend to
sync only the information that can be changed.</p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 1. Model for views</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">/// This contains all information that is not modified by users</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">struct ViewPasseneger {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let id: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let name: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let seat: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let vip: Bool</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    var status: Int // this can be modified by user</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    var crewNote: String // this can be modified by user</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// 2. Model for sync</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">/// This contains information that only modified by users</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">/// Less data, faster to sync!</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">struct DittoPassenger {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let id: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      var status: Int // this can be modified by user</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      var crewNote: String // this can be modified by user</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="creating-relationships">Creating relationships<a aria-hidden="true" class="hash-link" href="#creating-relationships" title="Direct link to heading">​</a></h2><p>Ditto does not support nesting documents or collections. If you need to create relationships
between documents, use a foreign key relationship by referencing the <code>_id</code> of
the document.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="️-bad-pattern-big-documents">⚠️ Bad pattern: Big documents<a aria-hidden="true" class="hash-link" href="#️-bad-pattern-big-documents" title="Direct link to heading">​</a></h3><p>Documents should not be larger than 250Kb. Any document that is larger than 5MB
will not synchronize to other peers. Ditto over Bluetooth LE typically
synchronizes documents at a maximum speed of 20 kB/second. This means that a
single document that is 250kb large could take 10 seconds (in the best case
scenario) to synchronize for the first time between devices.</p><p>Ditto breaks a document into chunks, synchronize those parts over the mesh, and
then reconstructs the document on the other side. Once the document has been
reconstructed, it will be returned from the callback and can be rendered in the
UI. This means that a user would see a loading spinner for 10 seconds. </p><div class="mermaid" data-mermaid-src="erDiagram
    PEOPLE {
        string _id
        string name
        int age
        map[car] cars
    }">erDiagram
    PEOPLE {
        string _id
        string name
        int age
        map[car] cars
    }</div><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 jsonc"><pre tabindex="0" class="prism-code language-jsonc codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;name&quot;: &quot;Susan&quot;,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;cars&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;abc123&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        &quot;make&quot;: &quot;Hyundai&quot;,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        &quot;color&quot;: &quot;red&quot;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      },</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      &quot;def456&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        &quot;make&quot;: &quot;Jeep&quot;,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        &quot;color&quot;: &quot;pink&quot;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      ...</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="-good-pattern-flat-models">👍 Good pattern: Flat models<a aria-hidden="true" class="hash-link" href="#-good-pattern-flat-models" title="Direct link to heading">​</a></h3><p>Ditto syncs and queries documents based on a combination of the collection name and the document <code>_id</code>.
Collections are a way to create an index to a set of related documents. You can
create foreign relationships between documents by referencing the <code>_id</code>. For
example, you may have an <code>orders</code> collection and a <code>customers</code> collection.</p><div class="mermaid" data-mermaid-src="erDiagram
    PEOPLE ||--o{ CARS : owns
    PEOPLE {
        string _id
        string name
        int age
    }
    CARS {
        complex _id
        string make
        string color 
    }">erDiagram
    PEOPLE ||--o{ CARS : owns
    PEOPLE {
        string _id
        string name
        int age
    }
    CARS {
        complex _id
        string make
        string color 
    }</div><p>In the above example, each car is owned by a person. We represent this by using
the <code>_id.owner</code> field to relate to the person&#x27;s <code>_id</code>. </p><p>When Susan gets a car, you can create a new document in the <code>cars</code> collection
with the foreign key relationship to the <code>people</code> collection.</p><p>In the <code>people</code> collection:</p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 jsonc"><pre tabindex="0" class="prism-code language-jsonc codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;_id&quot;: &quot;abc123&quot;,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;name&quot;: &quot;Susan&quot;,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;age&quot;: 31</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><p>In the <code>cars</code> collection.</p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 jsonc"><pre tabindex="0" class="prism-code language-jsonc codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;_id&quot;: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &quot;orderId&quot;: &quot;def456&quot;,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &quot;owner&quot;: &quot;abc123&quot; </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  },</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;make&quot;: &quot;Hyundai&quot;,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;color&quot;: &quot;red&quot;,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Remember, <code>_id</code> is immutable, so only use this pattern when you are
dealing with static identifiers within your foreign key relationship. </p></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="using-a-write-transaction">Using a Write Transaction<a aria-hidden="true" class="hash-link" href="#using-a-write-transaction" title="Direct link to heading">​</a></h4><p>When inserting a new car and a person at the same time, we want to use a a write
transaction. This allows a device to perform atomic transactions across
collections within a single database call. This means that both documents will be synchronized
at the same time to other devices. </p><p>In our above example, this ensures that a peer will always see the person
document for Susan if they have received the Hyundai document.</p><div class="tabs-container"><div class="sm:hidden"><label for="tabs" class="sr-only">Select a tab</label><select id="tabs" name="tabs" class="block w-full focus:ring-blue-500 focus:border-blue-500 border-gray-300 rounded-md"><option selected="" value="swift">Swift</option><option value="objc">Objective-C</option></select></div><div class="hidden sm:block"><nav class="flex space-x-4" aria-label="Tabs"><button class="bg-blue-100 text-blue-700 px-3 py-2 font-medium text-sm rounded-md" aria-current="page">Swift</button><button class="text-gray-500 hover:text-gray-700 px-3 py-2 font-medium text-sm rounded-md">Objective-C</button></nav></div><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">ditto.store.write { transaction in</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let cars = transaction.scoped(toCollectionNamed: &quot;cars&quot;)</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let people = transaction.scoped(toCollectionNamed: &quot;people&quot;)</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let docId = &quot;abc123&quot;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    do {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try people.upsert([&quot;_id&quot;: docId, &quot;name&quot;: &quot;Susan&quot;] as [String: Any?])</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try cars.upsert([&quot;make&quot;: &quot;Ford&quot;, &quot;color&quot;: &quot;red&quot;, &quot;owner&quot;: docId] as [String: Any?])</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try cars.upsert([&quot;make&quot;: &quot;Toyota&quot;, &quot;color&quot;: &quot;black&quot;, &quot;owner&quot;: docId] as [String: Any?])</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    } catch (let err) {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      print(err.localizedDescription)</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    people.findByID(docId).evict()</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 objc"><pre tabindex="0" class="prism-code language-objc codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">NSArray </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">results </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">store write</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token operator" style="color:rgb(212, 212, 212)">^</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">DITWriteTransaction </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">tx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    DITScopedWriteTransaction </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">cars </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> tx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;cars&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    DITScopedWriteTransaction </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">people </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> tx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;people&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    DITDocumentID </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">docID </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">DITDocumentID alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> initWithValue</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;abc123&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">people upsert</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token operator" style="color:rgb(212, 212, 212)">@</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;_id&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> docID</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;name&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;Susan&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">nil</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">cars upsert</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token operator" style="color:rgb(212, 212, 212)">@</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;make&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;Ford&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;color&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;black&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;owner&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> docID</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">nil</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">cars upsert</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token operator" style="color:rgb(212, 212, 212)">@</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;make&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;Toyota&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;color&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;red&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">@&quot;owner&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> docID</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">nil</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div></div></div></div><p>For more information about write transactions, see the section on <a href="/raspberrypi/common/concepts/writing#batching-multiple-updates-in-a-single-transaction">Writing -&gt; Batching</a>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="using-properties-to-define-behavior">Using properties to define behavior<a aria-hidden="true" class="hash-link" href="#using-properties-to-define-behavior" title="Direct link to heading">​</a></h2><p>There are situations where you want to show a document in a view only for some circumstances.
In these cases, we recommend that the model have a boolean property that
determines if the received data should be shown in the UI. </p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">// Document content</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">let note = [&quot;text&quot;: text, &quot;firstClassOnly&quot;: false]</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">if !note.firstClassOnly {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // Show it on UI</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="versioning">Versioning<a aria-hidden="true" class="hash-link" href="#versioning" title="Direct link to heading">​</a></h2><p>Ditto&#x27;s replication protocol is backwards-compatible and reliable. This means
that eventually you will have the <em>&quot;couch device problem&quot;</em> (i.e., a device that
fell behind a couch). In other words, a device in your mesh may be offline for a
significant amount of time before connecting back with other devices. </p><p>If the shape of your documents are significantly different on that device, there
could be documents that do not conform with your new application code.
Synchronizing with this &quot;couch device&quot; could cause other devices to crash
unexpectedly in production if precautions aren&#x27;t taken in your application
schema.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="when-do-i-version-my-documents">When do I version my documents?<a aria-hidden="true" class="hash-link" href="#when-do-i-version-my-documents" title="Direct link to heading">​</a></h3><p>Changing your schema is inevitable. To ensure reliability over time, you
should create your own schema versioning pattern for each Ditto document.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="same-version-compatibility">Same-version compatibility<a aria-hidden="true" class="hash-link" href="#same-version-compatibility" title="Direct link to heading">​</a></h3><p>Some applications do not need backward- or forward- compatibility, which can
simplify their business logic significantly.  If that sounds like your
application, we recommend that you use a pattern where you change the name of
the collection for each schema version of your application. This enforces
further that field types never change. For example, you can use
<code>myCollection_v{number}</code> as a convention to specify the collection schema
version your app will be listening to. When a schema change is necessary, bump
the number. Collections are very cheap to create in Ditto, so this will scale
even for applications that run for many years. </p><p>You could also only synchronize documents that come from schema versions
that are the same as your current schema version.  </p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 js"><pre tabindex="0" class="prism-code language-js codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> query </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;name == $args.name &amp;&amp; age &lt;= $args.age &amp;&amp; _schemaVersion == 1&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">collection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">find</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token literal-property property">age</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token literal-property property">name</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Max&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="forward-compatibility">Forward-compatibility<a aria-hidden="true" class="hash-link" href="#forward-compatibility" title="Direct link to heading">​</a></h3><p>In a typical centralized database like PostgreSQL, developers often focus on
backward-compatbility, where newer versions of the application can open old
documents. In a distributed system, you do not have central control of all
modifications to data. In an offline peer-to-peer mesh, it is difficult and
sometimes impossible to control all versions of your application that are active
in production environments. Because of these constraints, you need to not only
think of backward-compatibility, but also forward-compatibility.</p><p>An application is forward-compatible when existing code is able to read new
data. We can see <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/Writing_forward-compatible_websites" target="_blank" rel="noopener noreferrer">forward-compatibility in web development</a>.</p><p>To achieve forward-compatibility of your database, you should never change
the type of an existing field. In other words, developers should only ever add
new fields, and never remove or modify old fields. You can ensure this by
creating a controller that encapsulates Ditto and is used across your
application(s) to validate the field values and their associated types before
upserting those values into the database.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="backward-compatibility">Backward-compatibility<a aria-hidden="true" class="hash-link" href="#backward-compatibility" title="Direct link to heading">​</a></h3><p>Older data could be very important, or it could not be. It&#x27;s your choice to
decide what to do with these old documents: you could accept (as-is), reject
(ignore), or migrate them to the new schema.</p><p>For example, here&#x27;s a breaking version change where we add a new field and
change the type of an old field:</p><p><strong>App version 2</strong></p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">private struct V1Car {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let _id: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let make: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let model: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let year: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    var version: Int</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    init(doc: DittoDocument) {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      self._id = doc[&quot;_id&quot;].stringValue</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      self.make = doc[&quot;make&quot;].stringValue</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      self.model = doc[&quot;model&quot;].stringValue</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      self.year = doc[&quot;year&quot;].stringValue</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      self.version = doc[&quot;version&quot;].intValue</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">private struct V2Car {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let _id: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let make: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let model: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let year: Int</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let hometown: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    var version: Int</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    init(_id: String, make: String, model: String, year: Int, hometown: String, version: Int) {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        self._id = _id</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        self.make = make</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        self.model = model</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        self.year = year</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        self.hometown = hometown</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        self.version = version</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    init(doc: DittoDocument) {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        self._id = doc[&quot;_id&quot;].stringValue</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        self.make = doc[&quot;make&quot;].stringValue</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        self.model = doc[&quot;model&quot;].stringValue</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        self.year = doc[&quot;year&quot;].intValue</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        self.hometown = doc[&quot;hometown&quot;].stringValue</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        self.version = doc[&quot;version&quot;].intValue</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">func decode(car: DittoDocument) -&gt; V2Car {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  switch(car.version) {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    case 1 {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      let oldCar = V1Car(car)</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      let migratedCar = V2Car(_id: oldCar._id, make: oldCar.make, model: oldCar.model, year: Int(oldCar.year), hometown: &quot;N/A&quot;, version: 2)</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      return migratedCar</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    case 2 {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      return V2Car(car)</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><p><strong>App version 1</strong></p><p>You also may want to ignore documents that come from incompatible applications.</p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 swift"><pre tabindex="0" class="prism-code language-swift codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token plain">private struct V1Car {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let _id: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let make: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let model: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    let year: String</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    var version: Int</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    init(doc: DittoDocument) {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      self._id = doc[&quot;_id&quot;].stringValue</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      self.make = doc[&quot;make&quot;].stringValue</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      self.model = doc[&quot;model&quot;].stringValue</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      self.year = doc[&quot;year&quot;].stringValue</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      self.version = doc[&quot;version&quot;].intValue</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">func decode(car: DittoDocument) -&gt; V1Car {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  switch(car.version) {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    case 1 :</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      let oldCar = V1Car(car)</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      return oldCar</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    default:</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      // create default car item, or ignore document altogether</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      return</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  }</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="supporting-the-latest-version">Supporting the latest version<a aria-hidden="true" class="hash-link" href="#supporting-the-latest-version" title="Direct link to heading">​</a></h3><p>When a new application version is detected, you can stop synchronizing. You can detect that a new application version is available by querying for a
<code>_schemaVersion</code> that is greater than the current version. If a new version is
detected, stop sync and tell the user they need to upgrade their app to the
latest version. </p><div class="codeBlockContainer_EiTO"><div class="codeBlockContent_X2I6 js"><pre tabindex="0" class="prism-code language-js codeBlock_UxnK thin-scrollbar"><code class="codeBlockLines_W6UD"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> query </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;_schemaVersion &gt; 1&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">collection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">find</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">observeLocal</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Notify user to update to latest application version.</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ditto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">stopSync</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_V-PD clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><p>This is a common pattern that many applications use. For example, Apple Notes
warns users that they are on an older version and will experience degraded
features until they upgrade.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/getditto/docs/edit/main/docs/common/concepts/schemas.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/common/concepts/remove"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->Removing</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/common/mesh-network/supported-transports"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overview<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#separating-models-for-sync-and-views" class="table-of-contents__link toc-highlight">Separating models for sync and views</a></li><li><a href="#creating-relationships" class="table-of-contents__link toc-highlight">Creating relationships</a><ul><li><a href="#️-bad-pattern-big-documents" class="table-of-contents__link toc-highlight">⚠️ Bad pattern: Big documents</a></li><li><a href="#-good-pattern-flat-models" class="table-of-contents__link toc-highlight">👍 Good pattern: Flat models</a></li></ul></li><li><a href="#using-properties-to-define-behavior" class="table-of-contents__link toc-highlight">Using properties to define behavior</a></li><li><a href="#versioning" class="table-of-contents__link toc-highlight">Versioning</a><ul><li><a href="#when-do-i-version-my-documents" class="table-of-contents__link toc-highlight">When do I version my documents?</a></li><li><a href="#same-version-compatibility" class="table-of-contents__link toc-highlight">Same-version compatibility</a></li><li><a href="#forward-compatibility" class="table-of-contents__link toc-highlight">Forward-compatibility</a></li><li><a href="#backward-compatibility" class="table-of-contents__link toc-highlight">Backward-compatibility</a></li><li><a href="#supporting-the-latest-version" class="table-of-contents__link toc-highlight">Supporting the latest version</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Documentation</a></li><li class="footer__item"><a href="https://www.ditto.live/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Main Website</span></a></li><li class="footer__item"><a href="https://github.com/getditto/samples" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Example Apps</span></a></li><li class="footer__item"><a class="footer__link-item" href="/changelog">Changelog</a></li><li class="footer__item"><a href="https://portal.ditto.live" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Login</span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/getditto/docs/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub Discussions</span></a></li><li class="footer__item"><a href="https://github.com/getditto/docs/discussions/categories/roadmap-and-ideas" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Roadmap</span></a></li><li class="footer__item"><a href="https://github.com/getditto/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Open Source</span></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/ditto" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow</span></a></li><li class="footer__item"><a href="https://twitter.com/dittolive" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter</span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 DittoLive, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.117e8c63.js"></script>
<script src="/assets/js/main.862d2ea9.js"></script>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PV7QFWF" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) --></body>
</html>